<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>รายละเอียดอุปกรณ์เช่า</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f4f1ec;
  padding: 20px;
  max-width: 700px;
  margin: auto;
  color: #5d4e37;
}
h1 {
  text-align: center;
  margin-bottom: 30px;
}
.detail-container {
  background: #faf8f4;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(101, 67, 33, 0.1);
}
.field {
  margin-bottom: 20px;
}
.field strong {
  display: inline-block;
  width: 120px;
}
.images {
  margin-top: 20px;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}
.images img {
  width: 150px;
  height: 150px;
  object-fit: cover;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(101, 67, 33, 0.2);
}
.back-btn {
  display: block;
  margin: 30px auto 0;
  background-color: #296169;
  color: #faf8f4;
  text-align: center;
  padding: 15px 40px;
  border-radius: 30px;
  text-decoration: none;
  font-weight: 600;
  width: fit-content;
}
.back-btn:hover {
  background-color: #7f616d;
}
.contact-btn {
  display: inline-block;
  margin-top: 20px;
  background-color: #dc403e;
  color: #faf8f4;
  padding: 12px 30px;
  border-radius: 30px;
  text-decoration: none;
  font-weight: 600;
}
.contact-btn:hover {
  background-color: #f68b32;
}
.btn-group {
  display: flex;
  gap: 0px; /* ระยะห่างระหว่างปุ่ม */
  justify-content: center; /* จัดให้อยู่กึ่งกลาง */
  margin-top: 30px;
}

</style>
</head>
<body>

<h1>รายละเอียดอุปกรณ์เช่า</h1>

<div class="detail-container" id="detailContainer"></div>

<div class="btn-group">
  <a href="file:///C:/Users/Donut/Desktop/Shao/index.html" class="back-btn">หน้าหลัก</a>
  <a href="p1.html" class="back-btn">รายการอุปกรณ์</a>
</div>

<script>
function getQueryParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

const id = getQueryParam('id');
const detailContainer = document.getElementById('detailContainer');

if (!id) {
  detailContainer.innerHTML = '<p>ไม่พบข้อมูลอุปกรณ์</p>';
} else {
  const rentals = JSON.parse(localStorage.getItem('rentals') || '[]');
  const item = rentals.find(r => r.id == id);

  if (!item) {
    detailContainer.innerHTML = '<p>ไม่พบข้อมูลอุปกรณ์ที่เลือก</p>';
  } else {
    detailContainer.innerHTML = `
      <div class="field"><strong>ชื่ออุปกรณ์:</strong> ${item.deviceName}</div>
      <div class="field"><strong>หมวดหมู่:</strong> ${item.category}</div>
      <div class="field"><strong>ราคา/วัน:</strong> ${item.pricePerDay} บาท</div>
      <div class="field"><strong>จำนวนวันที่ปล่อยเช่า:</strong> ${item.rentalDays} วัน</div>
      <div class="field"><strong>รายละเอียด:</strong><br>${item.description.replace(/\n/g, '<br>')}</div>
      <div class="field"><strong>สถานที่:</strong> ${item.location}</div>
      <div class="field"><strong>ชื่อผู้ให้เช่า:</strong> ${item.ownerName}</div>
      <div class="field"><strong>Email:</strong> ${item.email}</div>
      <div class="field"><strong>รูปภาพ:</strong></div>
      <div class="images">
        ${item.images.map(src => `<img src="${src}" alt="รูปอุปกรณ์" />`).join('')}
      </div>
      <center>
        <a href="#" class="contact-btn" onclick="handleRentalRequest('${item.id}', event)">ติดต่อเช่า</a>
      </center>
    `;
  }
}

function handleRentalRequest(itemId, e) {
  e.preventDefault();

  const rentals = JSON.parse(localStorage.getItem('rentals') || '[]');
  const item = rentals.find(r => r.id == itemId);
  if (!item) return alert("ไม่พบข้อมูลอุปกรณ์");

  let requests = JSON.parse(localStorage.getItem('rentalRequests') || '[]');

  const today = new Date();
  const endDate = new Date(today.getTime() + item.rentalDays * 24 * 60 * 60 * 1000);
  const requestId = 'REQ-' + Date.now();

  const newRequest = {
    id: requestId,
    deviceName: item.deviceName,
    category: item.category,
    pricePerDay: item.pricePerDay,
    rentalDays: item.rentalDays,
    description: item.description || '',
    location: item.location,
    ownerName: item.ownerName,
    email: item.email,
    images: item.images || [],
    startDate: today.toISOString().split('T')[0],
    endDate: endDate.toISOString().split('T')[0],
    status: "รอผู้ปล่อยเช่ายืนยัน"
  };

  requests.push(newRequest);
  localStorage.setItem('rentalRequests', JSON.stringify(requests));

  window.location.href = `track.html?id=${requestId}`;
}
</script>

</body>
</html>
